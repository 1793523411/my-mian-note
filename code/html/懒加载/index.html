<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <img src="https://dss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=1933440720,2469399825&fm=26&gp=0.jpg"
        data-src="https://dss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=3461177213,1528805342&fm=26&gp=0.jpg" />
    <img src="https://dss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=3461177213,1528805342&fm=26&gp=0.jpg"
        data-src="https://dss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=3461177213,1528805342&fm=26&gp=0.jpg" />
    <img src="https://dss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=1933440720,2469399825&fm=26&gp=0.jpg"
        data-src="https://dss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=3461177213,1528805342&fm=26&gp=0.jpg" />
    <img src="https://dss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=1933440720,2469399825&fm=26&gp=0.jpg"
        data-src="https://dss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=3461177213,1528805342&fm=26&gp=0.jpg" />
    <img src="https://dss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=1933440720,2469399825&fm=26&gp=0.jpg"
        data-src="https://dss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=3461177213,1528805342&fm=26&gp=0.jpg" />
    <img src="https://dss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=1933440720,2469399825&fm=26&gp=0.jpg"
        data-src="https://dss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=3461177213,1528805342&fm=26&gp=0.jpg" />
    <img src="https://dss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=1933440720,2469399825&fm=26&gp=0.jpg"
        data-src="https://dss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=3461177213,1528805342&fm=26&gp=0.jpg" />
    <img src="https://dss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=1933440720,2469399825&fm=26&gp=0.jpg"
        data-src="https://dss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=3461177213,1528805342&fm=26&gp=0.jpg" />
    <img src="https://dss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=1933440720,2469399825&fm=26&gp=0.jpg"
        data-src="https://dss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=3461177213,1528805342&fm=26&gp=0.jpg" />
    <script>
        let img = document.getElementsByTagName("img");
        let num = img.length;
        let count = 0;

        lazyload();

        window.addEventListener('scroll', lazyload);

        // function lazyload() {
        //     let viewHeight = document.documentElement.clientHeight;//视口高度
        //     let scrollTop = document.documentElement.scrollTop || document.body.scrollTop;//滚动条卷去的高度
        //     for (let i = count; i < num; i++) {
        //         // 元素现在已经出现在视口中
        //         if (img[i].offsetTop < scrollHeight + viewHeight) {
        //             if (img[i].getAttribute("src") !== "https://dss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=1933440720,2469399825&fm=26&gp=0.jpg") continue;
        //             img[i].src = img[i].getAttribute("data-src");
        //             count++;
        //         }
        //     }
        // }

        function lazyload() {
            for (let i = count; i < num; i++) {
                // 元素现在已经出现在视口中
                if (img[i].getBoundingClientRect().top < document.documentElement.clientHeight) {
                    if (img[i].getAttribute("src") !== "default.jpg") continue;
                    img[i].src = img[i].getAttribute("data-src");
                    count++;
                }
            }
        }


        // let img = document.getElementsByTagName("img");

        // const observer = new IntersectionObserver(changes => {
        //     //changes 是被观察的元素集合
        //     for (let i = 0, len = changes.length; i < len; i++) {
        //         let change = changes[i];
        //         // 通过这个属性判断是否在视口中
        //         if (change.isIntersecting) {
        //             const imgElement = change.target;
        //             imgElement.src = imgElement.getAttribute("data-src");
        //             observer.unobserve(imgElement);
        //         }
        //     }
        // })
        // Array.from(img).forEach(item => observer.observe(item));

    </script>
</body>

</html>